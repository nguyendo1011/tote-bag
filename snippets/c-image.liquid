{% doc %}
  Renders an image with responsive sizes and fetchpriority

  Accepts:
  - image: {Object} Image object
  - image_behavior: {String} Image behavior
  - fetch_priority: {String} Fetch priority
  - loading: {String} Loading attribute
  - alt: {String} Alt attribute

  Usage:
  {% render 'c-image', object: section.settings.image, image: image, loading: 'lazy', fetch_priority: 'low', alt: 'Image' %}
{% enddoc %}

{%- liquid
  assign obj_settings = object.settings
  assign image = image | default: obj_settings.image

  # Options
  assign fetch_priority = fetch_priority | default: 'low'
  assign loading = loading | default: 'lazy'
  assign alt = alt | default: image.alt | default: 'Image'
  assign image_behavior = image_behavior | default: obj_settings.image_behavior | default: ''

  assign page_width = settings.page_width
-%}

{%- if image_behavior == 'ambient' or image_behavior == 'zoom-in' -%}
  {%- assign widths = '198, 432, 642, 900, 1284, 1800' -%}
  {%- capture sizes -%}
  (min-width: {{ page_width }}px) {{ page_width | minus: 100 | divided_by: 1.6667 }}px,
  (min-width: 750px) calc((100vw - 130px) / 1.667), calc((100vw - 50px) / 1.667)
{%- endcapture -%}
{%- else -%}
  {%- assign widths = '165, 360, 535, 750, 1070, 1500' -%}
  {%- capture sizes -%}
  (min-width: {{ page_width }}px) {{ page_width | minus: 100 | divided_by: 2 }}px,
  (min-width: 750px) calc((100vw - 130px) / 2), calc((100vw - 50px) / 2)
{%- endcapture -%}
{%- endif -%}
{{
  image
  | image_url: width: 1500
  | image_tag: sizes: sizes, widths: widths, fetchpriority: fetch_priority, loading: loading
}}
