{% comment %}
  Embroidery Customization Component
  Usage: {% render 'embroidery' %}
{% endcomment %}

<div class="embroidery-section" x-data="embroideryCustomizer()">
  <!-- Embroidery Toggle -->
  <div class="mb-6">
    <label class="flex items-center cursor-pointer group">
      <input
        type="checkbox"
        x-model="enabled"
        class="w-5 h-5 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2 transition-colors"
      >
      <span class="ml-3 text-base font-medium text-gray-900 group-hover:text-gray-700">
        Add Embroidered Name
        <span x-show="enabled && price > 0" class="ml-2 text-sm text-gray-600">
          +$<span x-text="price.toFixed(2)"></span>
        </span>
      </span>
    </label>
  </div>

  <!-- Embroidery Options (shown when enabled) -->
  <div
    x-show="enabled"
    x-transition:enter="transition ease-out duration-200"
    x-transition:enter-start="opacity-0 transform -translate-y-2"
    x-transition:enter-end="opacity-100 transform translate-y-0"
    class="space-y-6 pl-8 pb-6 border-l-2 border-gray-200"
  >

    <!-- Name Input -->
    <div>
      <label for="embroidery-name" class="block text-sm font-medium text-gray-700 mb-2">
        Enter Name
        <span class="text-gray-500 font-normal">
          (<span x-text="nameLength"></span>/<span x-text="maxLength"></span>)
        </span>
      </label>
      <input
        type="text"
        id="embroidery-name"
        x-model="name"
        :maxlength="maxLength"
        placeholder="e.g., John Smith"
        class="w-full px-4 py-2.5 text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
      >
      <p class="mt-1.5 text-xs text-gray-500">Maximum {{ max_length | default: 12 }} characters</p>
    </div>

    <!-- Font Selection -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-3">
        Font Style
      </label>
      <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
        <template x-for="font in fonts" :key="font.id">
          <button
            type="button"
            @click="selectedFont = font.id"
            :class="{
              'border-blue-600 ring-2 ring-blue-200': selectedFont === font.id,
              'border-gray-300 hover:border-gray-400': selectedFont !== font.id
            }"
            class="relative p-4 border-2 rounded-lg text-center transition-all hover:shadow-sm"
          >
            <div
              class="text-lg font-medium mb-1"
              :style="'font-family: ' + font.family"
              x-text="font.preview"
            ></div>
            <div class="text-xs text-gray-600" x-text="font.name"></div>
            <div
              x-show="selectedFont === font.id"
              class="absolute top-2 right-2 w-5 h-5 bg-blue-600 rounded-full flex items-center justify-center"
            >
              <svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
              </svg>
            </div>
          </button>
        </template>
      </div>
    </div>

    <!-- Thread Color Selection -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-3">
        Thread Color
      </label>
      <div class="flex flex-wrap gap-3">
        <template x-for="color in colors" :key="color.id">
          <button
            type="button"
            @click="selectedColor = color.id"
            :title="color.name"
            :class="{
              'ring-2 ring-offset-2 ring-blue-600': selectedColor === color.id,
              'ring-1 ring-gray-300 hover:ring-gray-400': selectedColor !== color.id
            }"
            class="relative w-10 h-10 rounded-full transition-all"
            :style="'background-color: ' + color.hex"
          >
            <div
              x-show="selectedColor === color.id"
              class="absolute inset-0 flex items-center justify-center"
            >
              <svg class="w-5 h-5 text-white drop-shadow-lg" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
              </svg>
            </div>
          </button>
        </template>
      </div>
      <p class="mt-2 text-xs text-gray-600">
        Selected: <span class="font-medium" x-text="colors.find(c => c.id === selectedColor)?.name"></span>
      </p>
    </div>

    <!-- Preview Text -->
    <div
      x-show="name.length > 0"
      class="p-6 bg-gray-50 rounded-lg border border-gray-200"
    >
      <p class="text-xs text-gray-500 mb-2 uppercase tracking-wide">Preview</p>
      <p
        class="text-2xl font-medium text-center"
        :style="'font-family: ' + fonts.find(f => f.id === selectedFont)?.family + '; color: ' + colors.find(c => c.id === selectedColor)?.hex"
        x-text="name"
      ></p>
    </div>

  </div>

  <!-- Hidden inputs for form submission -->
  <input type="hidden" name="properties[Embroidery]" :value="enabled ? 'Yes' : 'No'">
  <input type="hidden" name="properties[Embroidery Name]" x-model="name" x-show="enabled">
  <input type="hidden" name="properties[Embroidery Font]" :value="fonts.find(f => f.id === selectedFont)?.name" x-show="enabled">
  <input type="hidden" name="properties[Embroidery Color]" :value="colors.find(c => c.id === selectedColor)?.name" x-show="enabled">
</div>

<script>
  function embroideryCustomizer() {
    return {
      enabled: false,
      name: '',
      maxLength: 12,
      selectedFont: 'classic',
      selectedColor: 'black',
      price: 5.00,

      fonts: [
        { id: 'classic', name: 'Classic', family: 'Georgia, serif', preview: 'Abc' },
        { id: 'modern', name: 'Modern', family: 'Arial, sans-serif', preview: 'Abc' },
        { id: 'script', name: 'Script', family: 'Brush Script MT, cursive', preview: 'Abc' },
        { id: 'bold', name: 'Bold', family: 'Impact, sans-serif', preview: 'Abc' },
        { id: 'elegant', name: 'Elegant', family: 'Times New Roman, serif', preview: 'Abc' },
        { id: 'casual', name: 'Casual', family: 'Comic Sans MS, cursive', preview: 'Abc' },
      ],

      colors: [
        { id: 'black', name: 'Black', hex: '#000000' },
        { id: 'white', name: 'White', hex: '#FFFFFF' },
        { id: 'navy', name: 'Navy Blue', hex: '#1E3A8A' },
        { id: 'red', name: 'Red', hex: '#DC2626' },
        { id: 'gold', name: 'Gold', hex: '#F59E0B' },
        { id: 'green', name: 'Forest Green', hex: '#065F46' },
        { id: 'pink', name: 'Pink', hex: '#EC4899' },
        { id: 'purple', name: 'Purple', hex: '#7C3AED' },
      ],

      get nameLength() {
        return this.name.length;
      }
    }
  }
</script>

<style>
  .embroidery-section [x-cloak] {
    display: none !important;
  }
</style>
