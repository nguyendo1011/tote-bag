{% comment %}
  Embroidery Customization Component
  Usage: {% render 'embroidery', product: product %}
{% endcomment %}

{% liquid
  assign store_has_embroidery_opts = false
  assign product_has_embroidery_opts = false

  # Check if setup collection embroidery and has products
  assign embroidery_products = settings.embroidery_products
  if embroidery_products.size > 0
    assign store_has_embroidery_opts = true
  endif

  # Check if product has embroidery options
  assign product_mtf_embroidery = product.metafields.custom.embroidery_options.value
  if product_mtf_embroidery.size > 0
    assign product_has_embroidery_opts = true
  endif

  # Get other information
  assign min_price = 0
  assign character_limit = product.metafields.custom.embroidery_letter_limit | default: 12
%}

{% comment %} Fast return if no embroidery options are available {% endcomment %}
{% if store_has_embroidery_opts == false or product_has_embroidery_opts == false %}{% break %}{% endif %}


{% capture options %}
  {% for product in embroidery_products %}
    {% if forloop.first %}
      <div class="tw-flex tw-flex-col tw-gap-2">
       <label for="embroidery-name"><input
        type="text"
        id="embroidery-name"
        data-embroidery-name
        maxlength="{{ character_limit }}"
        placeholder="e.g., John Smith"
        class="tw-w-full tw-px-4 tw-py-2 tw-text-base tw-border tw-border-gray-400 tw-rounded-[4px]"
      >
      <p>{{ "products.product.embroidery.add_character_limit" | t: character_limit: character_limit }}
        <span class="tw-text-gray-500 tw-font-normal ml-auto">
        (<span data-name-length>0</span>/<span data-name-max>12</span>)
      </span></p>
     </label>
       </div>
    {% endif %}
    {% for option in product.options_with_values %}
      {% for variant in product.variants %}
        {% if variant.available %}
          {% assign variant_price = variant.price %}
          {% if min_price < variant_price %}
            {% assign min_price = variant_price %}
          {% endif %}
        {% endif %}
      {% endfor %}
      <div class="tw-flex tw-flex-col tw-gap-3">
        <label class="tw-block tw-text-sm tw-font-medium tw-text-gray-700">
          {{ option.name }}
        </label>
        <div class="tw-flex tw-flex-wrap tw-gap-3" data-option-name="{{ option.name | handleize }}" data-product-id="{{ product.id }}">
          {% for value in option.values %}
            {% assign current_variant = null %}
            {% for variant in product.variants %}
              {% if variant.available and current_variant == null %}
                {% if option.position == 1 and variant.option1 == value %}
                  {% assign current_variant = variant %}
                {% elsif option.position == 2 and variant.option2 == value %}
                  {% assign current_variant = variant %}
                {% elsif option.position == 3 and variant.option3 == value %}
                  {% assign current_variant = variant %}
                {% endif %}
              {% endif %}
            {% endfor %}
            {% if option.name == 'Color' %}
              {% assign color_hex = '#000000' %}
              {% if current_variant %}
                {% assign color_hex = current_variant.metafields.custom.color_hex.value | default: '#000000' %}
              {% endif %}
              <label class="tw-flex tw-flex-col tw-items-center tw-gap-1 tw-cursor-pointer">
                <input
                  type="radio"
                  name="embroidery-{{ product.id }}-{{ option.name | handleize }}"
                  value="{{ value }}"
                  {% if current_variant %}data-variant-id="{{ current_variant.id }}"{% endif %}
                  data-option-name="{{ option.name | handleize }}"
                  data-product-id="{{ product.id }}"
                  class="tw-sr-only"
                >
                <button
                  type="button"
                  class="tw-relative tw-w-10 tw-h-10 tw-rounded-full tw-transition-all tw-ring-1 tw-ring-gray-300 hover:tw-ring-gray-400 tw-border-2 tw-border-transparent"
                  style="background-color: {{ color_hex }}"
                  data-option-value="{{ value }}"
                >
                  <svg class="tw-w-5 tw-h-5 tw-text-white tw-drop-shadow-lg tw-hidden tw-absolute tw-inset-0 tw-m-auto" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                  </svg>
                </button>
                <span class="tw-text-xs tw-text-gray-600">{{ value }}</span>
              </label>
            {% else %}
              <label class="tw-cursor-pointer">
                <input
                  type="radio"
                  name="embroidery-{{ product.id }}-{{ option.name | handleize }}"
                  value="{{ value }}"
                  {% if current_variant %}data-variant-id="{{ current_variant.id }}"{% endif %}
                  data-option-name="{{ option.name | handleize }}"
                  data-product-id="{{ product.id }}"
                  class="tw-sr-only"
                >
                <span class="tw-inline-block tw-px-4 tw-py-2 tw-text-sm tw-font-medium tw-text-center tw-border-2 tw-border-gray-300 hover:tw-border-gray-400 tw-rounded-lg tw-transition-all tw-bg-white">
                  {{ value }}
                </span>
              </label>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    {% endfor %}
    
  {% endfor %}
{% endcapture %}
<h1>store_has_embroidery_opts: {{ store_has_embroidery_opts }}</h1>
<h1>product_has_embroidery_opts: {{ product_has_embroidery_opts }}</h1>




<div class="embroidery-accordion" data-accordion>

  <!-- Accordion Toggle/Header -->
  <div class="embroidery-toggle" data-embroidery-toggle>
    <label class="tw-flex tw-items-center tw-cursor-pointer tw-py-4">
      <input
        type="checkbox"
        data-embroidery-checkbox
        class="tw-w-5 tw-h-5 tw-text-blue-600 tw-bg-gray-100 tw-border-gray-300 tw-rounded focus:tw-ring-blue-500 focus:tw-ring-2 tw-transition-colors tw-cursor-pointer"
      >
      <span class="tw-ml-3 tw-text-base tw-font-medium tw-text-gray-900 tw-flex-1">
        Add Embroidered Name
      </span>
      <span class="tw-text-sm tw-text-gray-600 tw-hidden" data-embroidery-price>
        +$5.00
      </span>
    </label>
  </div>

  <!-- Accordion Body (Collapsible Content) -->
  <div class="embroidery-body" data-embroidery-body>
    <div class="tw-pl-8 tw-pb-6 tw-border-l-2 tw-border-gray-200 tw-space-y-6">

      {{ options }}

      <!-- Font Selection -->
      <div>
        <label class="tw-block tw-text-sm tw-font-medium tw-text-gray-700 tw-mb-3">
          Font Style
        </label>
        <div class="tw-grid tw-grid-cols-2 sm:tw-grid-cols-3 tw-gap-3" data-font-options>
          <button
            type="button"
            data-font-id="classic"
            data-font-name="Classic"
            data-font-family="Georgia, serif"
            class="tw-relative tw-p-4 tw-border-2 tw-border-gray-300 hover:tw-border-gray-400 tw-rounded-lg tw-text-center tw-transition-all hover:tw-shadow-sm"
          >
            <div class="tw-text-lg tw-font-medium tw-mb-1" style="font-family: Georgia, serif">Abc</div>
            <div class="tw-text-xs tw-text-gray-600">Classic</div>
          </button>
          <button
            type="button"
            data-font-id="modern"
            data-font-name="Modern"
            data-font-family="Arial, sans-serif"
            class="tw-relative tw-p-4 tw-border-2 tw-border-gray-300 hover:tw-border-gray-400 tw-rounded-lg tw-text-center tw-transition-all hover:tw-shadow-sm"
          >
            <div class="tw-text-lg tw-font-medium tw-mb-1" style="font-family: Arial, sans-serif">Abc</div>
            <div class="tw-text-xs tw-text-gray-600">Modern</div>
          </button>
          <button
            type="button"
            data-font-id="script"
            data-font-name="Script"
            data-font-family="Brush Script MT, cursive"
            class="tw-relative tw-p-4 tw-border-2 tw-border-gray-300 hover:tw-border-gray-400 tw-rounded-lg tw-text-center tw-transition-all hover:tw-shadow-sm"
          >
            <div class="tw-text-lg tw-font-medium tw-mb-1" style="font-family: Brush Script MT, cursive">Abc</div>
            <div class="tw-text-xs tw-text-gray-600">Script</div>
          </button>
          <button
            type="button"
            data-font-id="bold"
            data-font-name="Bold"
            data-font-family="Impact, sans-serif"
            class="tw-relative tw-p-4 tw-border-2 tw-border-gray-300 hover:tw-border-gray-400 tw-rounded-lg tw-text-center tw-transition-all hover:tw-shadow-sm"
          >
            <div class="tw-text-lg tw-font-medium tw-mb-1" style="font-family: Impact, sans-serif">Abc</div>
            <div class="tw-text-xs tw-text-gray-600">Bold</div>
          </button>
          <button
            type="button"
            data-font-id="elegant"
            data-font-name="Elegant"
            data-font-family="Times New Roman, serif"
            class="tw-relative tw-p-4 tw-border-2 tw-border-gray-300 hover:tw-border-gray-400 tw-rounded-lg tw-text-center tw-transition-all hover:tw-shadow-sm"
          >
            <div class="tw-text-lg tw-font-medium tw-mb-1" style="font-family: Times New Roman, serif">Abc</div>
            <div class="tw-text-xs tw-text-gray-600">Elegant</div>
          </button>
          <button
            type="button"
            data-font-id="casual"
            data-font-name="Casual"
            data-font-family="Comic Sans MS, cursive"
            class="tw-relative tw-p-4 tw-border-2 tw-border-gray-300 hover:tw-border-gray-400 tw-rounded-lg tw-text-center tw-transition-all hover:tw-shadow-sm"
          >
            <div class="tw-text-lg tw-font-medium tw-mb-1" style="font-family: Comic Sans MS, cursive">Abc</div>
            <div class="tw-text-xs tw-text-gray-600">Casual</div>
          </button>
        </div>
      </div>

      <!-- Thread Color Selection -->
      <div>
        <label class="tw-block tw-text-sm tw-font-medium tw-text-gray-700 tw-mb-3">
          Thread Color
        </label>
        <div class="tw-flex tw-flex-wrap tw-gap-3" data-color-options>
          <button
            type="button"
            data-color-id="black"
            data-color-name="Black"
            data-color-hex="#000000"
            title="Black"
            class="tw-relative tw-w-10 tw-h-10 tw-rounded-full tw-transition-all tw-ring-1 tw-ring-gray-300 hover:tw-ring-gray-400"
            style="background-color: #000000"
          >
            <svg class="tw-w-5 tw-h-5 tw-text-white tw-drop-shadow-lg tw-hidden" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
            </svg>
          </button>
          <button
            type="button"
            data-color-id="white"
            data-color-name="White"
            data-color-hex="#FFFFFF"
            title="White"
            class="tw-relative tw-w-10 tw-h-10 tw-rounded-full tw-transition-all tw-ring-1 tw-ring-gray-300 hover:tw-ring-gray-400"
            style="background-color: #FFFFFF"
          >
            <svg class="tw-w-5 tw-h-5 tw-text-gray-800 tw-drop-shadow-lg tw-hidden" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
            </svg>
          </button>
          <button
            type="button"
            data-color-id="navy"
            data-color-name="Navy Blue"
            data-color-hex="#1E3A8A"
            title="Navy Blue"
            class="tw-relative tw-w-10 tw-h-10 tw-rounded-full tw-transition-all tw-ring-1 tw-ring-gray-300 hover:tw-ring-gray-400"
            style="background-color: #1E3A8A"
          >
            <svg class="tw-w-5 tw-h-5 tw-text-white tw-drop-shadow-lg tw-hidden" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
            </svg>
          </button>
          <button
            type="button"
            data-color-id="red"
            data-color-name="Red"
            data-color-hex="#DC2626"
            title="Red"
            class="tw-relative tw-w-10 tw-h-10 tw-rounded-full tw-transition-all tw-ring-1 tw-ring-gray-300 hover:tw-ring-gray-400"
            style="background-color: #DC2626"
          >
            <svg class="tw-w-5 tw-h-5 tw-text-white tw-drop-shadow-lg tw-hidden" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
            </svg>
          </button>
          <button
            type="button"
            data-color-id="gold"
            data-color-name="Gold"
            data-color-hex="#F59E0B"
            title="Gold"
            class="tw-relative tw-w-10 tw-h-10 tw-rounded-full tw-transition-all tw-ring-1 tw-ring-gray-300 hover:tw-ring-gray-400"
            style="background-color: #F59E0B"
          >
            <svg class="tw-w-5 tw-h-5 tw-text-white tw-drop-shadow-lg tw-hidden" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
            </svg>
          </button>
          <button
            type="button"
            data-color-id="green"
            data-color-name="Forest Green"
            data-color-hex="#065F46"
            title="Forest Green"
            class="tw-relative tw-w-10 tw-h-10 tw-rounded-full tw-transition-all tw-ring-1 tw-ring-gray-300 hover:tw-ring-gray-400"
            style="background-color: #065F46"
          >
            <svg class="tw-w-5 tw-h-5 tw-text-white tw-drop-shadow-lg tw-hidden" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
            </svg>
          </button>
          <button
            type="button"
            data-color-id="pink"
            data-color-name="Pink"
            data-color-hex="#EC4899"
            title="Pink"
            class="tw-relative tw-w-10 tw-h-10 tw-rounded-full tw-transition-all tw-ring-1 tw-ring-gray-300 hover:tw-ring-gray-400"
            style="background-color: #EC4899"
          >
            <svg class="tw-w-5 tw-h-5 tw-text-white tw-drop-shadow-lg tw-hidden" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
            </svg>
          </button>
          <button
            type="button"
            data-color-id="purple"
            data-color-name="Purple"
            data-color-hex="#7C3AED"
            title="Purple"
            class="tw-relative tw-w-10 tw-h-10 tw-rounded-full tw-transition-all tw-ring-1 tw-ring-gray-300 hover:tw-ring-gray-400"
            style="background-color: #7C3AED"
          >
            <svg class="tw-w-5 tw-h-5 tw-text-white tw-drop-shadow-lg tw-hidden" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
            </svg>
          </button>
        </div>
        <p class="tw-mt-2 tw-text-xs tw-text-gray-600">
          Selected: <span class="tw-font-medium" data-selected-color-name>Black</span>
        </p>
      </div>

      <!-- Preview Text -->
      <div class="tw-p-6 tw-bg-gray-50 tw-rounded-lg tw-border tw-border-gray-200 tw-hidden" data-preview-container>
        <p class="tw-text-xs tw-text-gray-500 tw-mb-2 tw-uppercase tw-tracking-wide">Preview</p>
        <p
          class="tw-text-2xl tw-font-medium tw-text-center"
          data-preview-text
          style="font-family: Georgia, serif; color: #000000"
        ></p>
      </div>

    </div>
  </div>

  <!-- Hidden inputs for form submission -->
  <input type="hidden" name="properties[Embroidery]" value="No" data-embroidery-enabled>
  <input type="hidden" name="properties[Embroidery Name]" value="" data-embroidery-name-value>
  <input type="hidden" name="properties[Embroidery Font]" value="Classic" data-embroidery-font-value>
  <input type="hidden" name="properties[Embroidery Color]" value="Black" data-embroidery-color-value>
</div>

<script src="{{ 'embroidery-accordion.js' | asset_url }}" defer></script>


<script>
  (function() {
    const container = document.querySelector('[data-accordion]');
    if (!container) return;

    const nameInput = container.querySelector('[data-embroidery-name]');
    const nameLength = container.querySelector('[data-name-length]');
    const fontButtons = container.querySelectorAll('[data-font-id]');
    const colorButtons = container.querySelectorAll('[data-color-id]');
    const previewContainer = container.querySelector('[data-preview-container]');
    const previewText = container.querySelector('[data-preview-text]');
    const selectedColorName = container.querySelector('[data-selected-color-name]');
    const checkbox = container.querySelector('[data-embroidery-checkbox]');

    // Hidden inputs
    const enabledInput = container.querySelector('[data-embroidery-enabled]');
    const nameValueInput = container.querySelector('[data-embroidery-name-value]');
    const fontValueInput = container.querySelector('[data-embroidery-font-value]');
    const colorValueInput = container.querySelector('[data-embroidery-color-value]');

    let selectedFont = { id: 'classic', name: 'Classic', family: 'Georgia, serif' };
    let selectedColor = { id: 'black', name: 'Black', hex: '#000000' };

    // Set first font and color as selected
    if (fontButtons[0]) {
      fontButtons[0].classList.add('tw-border-blue-600', 'tw-ring-2', 'tw-ring-blue-200');
      fontButtons[0].innerHTML += '<div class="tw-absolute tw-top-2 tw-right-2 tw-w-5 tw-h-5 tw-bg-blue-600 tw-rounded-full tw-flex tw-items-center tw-justify-center"><svg class="tw-w-3 tw-h-3 tw-text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg></div>';
    }
    if (colorButtons[0]) {
      colorButtons[0].classList.remove('tw-ring-1', 'tw-ring-gray-300');
      colorButtons[0].classList.add('tw-ring-2', 'tw-ring-offset-2', 'tw-ring-blue-600');
      colorButtons[0].querySelector('svg').classList.remove('tw-hidden');
    }

    // Name input handler
    if (nameInput) {
      nameInput.addEventListener('input', (e) => {
        const value = e.target.value;
        if (nameLength) nameLength.textContent = value.length;
        if (nameValueInput) nameValueInput.value = value;
        updatePreview();
      });
    }

    // Font selection handler
    fontButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        // Remove selection from all buttons
        fontButtons.forEach(b => {
          b.classList.remove('tw-border-blue-600', 'tw-ring-2', 'tw-ring-blue-200');
          b.classList.add('tw-border-gray-300');
          const checkmark = b.querySelector('.tw-absolute');
          if (checkmark) checkmark.remove();
        });

        // Add selection to clicked button
        btn.classList.remove('tw-border-gray-300');
        btn.classList.add('tw-border-blue-600', 'tw-ring-2', 'tw-ring-blue-200');
        btn.innerHTML += '<div class="tw-absolute tw-top-2 tw-right-2 tw-w-5 tw-h-5 tw-bg-blue-600 tw-rounded-full tw-flex tw-items-center tw-justify-center"><svg class="tw-w-3 tw-h-3 tw-text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg></div>';

        selectedFont = {
          id: btn.dataset.fontId,
          name: btn.dataset.fontName,
          family: btn.dataset.fontFamily
        };

        if (fontValueInput) fontValueInput.value = selectedFont.name;
        updatePreview();
      });
    });

    // Color selection handler
    colorButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        // Remove selection from all buttons
        colorButtons.forEach(b => {
          b.classList.remove('tw-ring-2', 'tw-ring-offset-2', 'tw-ring-blue-600');
          b.classList.add('tw-ring-1', 'tw-ring-gray-300');
          b.querySelector('svg').classList.add('tw-hidden');
        });

        // Add selection to clicked button
        btn.classList.remove('tw-ring-1', 'tw-ring-gray-300');
        btn.classList.add('tw-ring-2', 'tw-ring-offset-2', 'tw-ring-blue-600');
        btn.querySelector('svg').classList.remove('tw-hidden');

        selectedColor = {
          id: btn.dataset.colorId,
          name: btn.dataset.colorName,
          hex: btn.dataset.colorHex
        };

        if (selectedColorName) selectedColorName.textContent = selectedColor.name;
        if (colorValueInput) colorValueInput.value = selectedColor.name;
        updatePreview();
      });
    });

    // Update checkbox state
    if (checkbox) {
      checkbox.addEventListener('change', (e) => {
        if (enabledInput) enabledInput.value = e.target.checked ? 'Yes' : 'No';
      });
    }

    function updatePreview() {
      if (!previewText || !previewContainer) return;

      const name = nameInput ? nameInput.value : '';

      if (name.length > 0) {
        previewText.textContent = name;
        previewText.style.fontFamily = selectedFont.family;
        previewText.style.color = selectedColor.hex;
        previewContainer.classList.remove('tw-hidden');
      } else {
        previewContainer.classList.add('tw-hidden');
      }
    }

    // Handle dynamic product option selections
    const optionContainers = container.querySelectorAll('[data-option-name]');
    optionContainers.forEach(optionContainer => {
      const optionName = optionContainer.dataset.optionName;
      const productId = optionContainer.dataset.productId;
      const parentDiv = optionContainer.closest('.tw-flex.tw-flex-col');
      const labelElement = parentDiv?.querySelector('label.tw-block');
      const isColorOption = labelElement?.textContent.trim() === 'Color';
      const radioInputs = optionContainer.querySelectorAll('input[type="radio"]');
      const labels = optionContainer.querySelectorAll('label');

      // Set first option as selected by default
      if (radioInputs[0]) {
        radioInputs[0].checked = true;
        updateOptionSelection(radioInputs[0], isColorOption);
      }

      // Handle label/button clicks
      labels.forEach(label => {
        const radio = label.querySelector('input[type="radio"]');
        const button = label.querySelector('button');
        const span = label.querySelector('span:not(.tw-text-xs)');

        if (button) {
          button.addEventListener('click', (e) => {
            e.preventDefault();
            if (radio) {
              radio.checked = true;
              updateOptionSelection(radio, isColorOption);
            }
          });
        } else if (span) {
          span.addEventListener('click', (e) => {
            e.preventDefault();
            if (radio) {
              radio.checked = true;
              updateOptionSelection(radio, isColorOption);
            }
          });
        }
      });

      // Handle direct radio input changes
      radioInputs.forEach(radio => {
        radio.addEventListener('change', () => {
          if (radio.checked) {
            updateOptionSelection(radio, isColorOption);
          }
        });
      });
    });

    function updateOptionSelection(selectedRadio, isColorOption) {
      const optionContainer = selectedRadio.closest('[data-option-name]');
      const allRadios = optionContainer.querySelectorAll('input[type="radio"]');

      allRadios.forEach(radio => {
        const label = radio.closest('label');
        if (!label) return;

        if (isColorOption) {
          const button = label.querySelector('button');
          const svg = label.querySelector('svg');
          if (button && svg) {
            if (radio.checked) {
              button.classList.remove('tw-ring-1', 'tw-ring-gray-300');
              button.classList.add('tw-ring-2', 'tw-ring-offset-2', 'tw-ring-blue-600');
              svg.classList.remove('tw-hidden');
            } else {
              button.classList.remove('tw-ring-2', 'tw-ring-offset-2', 'tw-ring-blue-600');
              button.classList.add('tw-ring-1', 'tw-ring-gray-300');
              svg.classList.add('tw-hidden');
            }
          }
        } else {
          const span = label.querySelector('span:not(.tw-text-xs)');
          if (span) {
            if (radio.checked) {
              span.classList.remove('tw-border-gray-300');
              span.classList.add('tw-border-blue-600', 'tw-ring-2', 'tw-ring-blue-200');
            } else {
              span.classList.remove('tw-border-blue-600', 'tw-ring-2', 'tw-ring-blue-200');
              span.classList.add('tw-border-gray-300');
            }
          }
        }
      });
    }
  })();
</script>

<style>
  .embroidery-toggle.is-open {
    /* Optional: Add any styles for open state */
  }
</style>
