{% comment %}
  Embroidery Customization Component
  Usage: {% render 'embroidery' %}
{% endcomment %}

<div class="embroidery-section" x-data="embroideryCustomizer()">
  <!-- Embroidery Toggle -->
  <div class="tw-mb-6">
    <label class="tw-flex tw-items-center tw-cursor-pointer group">
      <input
        type="checkbox"
        x-model="enabled"
        class="tw-w-5 tw-h-5 tw-text-blue-600 tw-bg-gray-100 tw-border-gray-300 tw-rounded focus:tw-ring-blue-500 focus:tw-ring-2 tw-transition-colors"
      >
      <span class="tw-ml-3 tw-text-base tw-font-medium tw-text-gray-900 group-hover:tw-text-gray-700">
        Add Embroidered Name
        <span x-show="enabled && price > 0" class="tw-ml-2 tw-text-sm tw-text-gray-600">
          +$<span x-text="price.toFixed(2)"></span>
        </span>
      </span>
    </label>
  </div>

  <!-- Embroidery Options (shown when enabled) -->
  <div
    x-show="enabled"
    x-transition:enter="tw-transition tw-ease-out tw-duration-200"
    x-transition:enter-start="tw-opacity-0 tw-transform tw--translate-y-2"
    x-transition:enter-end="tw-opacity-100 tw-transform tw-translate-y-0"
    class="tw-space-y-6 tw-pl-8 tw-pb-6 tw-border-l-2 tw-border-gray-200"
  >

    <!-- Name Input -->
    <div>
      <label for="embroidery-name" class="tw-block tw-text-sm tw-font-medium tw-text-gray-700 tw-mb-2">
        Enter Name
        <span class="tw-text-gray-500 tw-font-normal">
          (<span x-text="nameLength"></span>/<span x-text="maxLength"></span>)
        </span>
      </label>
      <input
        type="text"
        id="embroidery-name"
        x-model="name"
        :maxlength="maxLength"
        placeholder="e.g., John Smith"
        class="tw-w-full tw-px-4 tw-py-2.5 tw-text-base tw-border tw-border-gray-300 tw-rounded-lg focus:tw-ring-2 focus:tw-ring-blue-500 focus:tw-border-blue-500 tw-transition-colors"
      >
      <p class="tw-mt-1.5 tw-text-xs tw-text-gray-500">Maximum {{ max_length | default: 12 }} characters</p>
    </div>

    <!-- Font Selection -->
    <div>
      <label class="tw-block tw-text-sm tw-font-medium tw-text-gray-700 tw-mb-3">
        Font Style
      </label>
      <div class="tw-grid tw-grid-cols-2 sm:tw-grid-cols-3 tw-gap-3">
        <template x-for="font in fonts" :key="font.id">
          <button
            type="button"
            @click="selectedFont = font.id"
            :class="{
              'tw-border-blue-600 tw-ring-2 tw-ring-blue-200': selectedFont === font.id,
              'tw-border-gray-300 hover:tw-border-gray-400': selectedFont !== font.id
            }"
            class="tw-relative tw-p-4 tw-border-2 tw-rounded-lg tw-text-center tw-transition-all hover:tw-shadow-sm"
          >
            <div
              class="tw-text-lg tw-font-medium tw-mb-1"
              :style="'font-family: ' + font.family"
              x-text="font.preview"
            ></div>
            <div class="tw-text-xs tw-text-gray-600" x-text="font.name"></div>
            <div
              x-show="selectedFont === font.id"
              class="tw-absolute tw-top-2 tw-right-2 tw-w-5 tw-h-5 tw-bg-blue-600 tw-rounded-full tw-flex tw-items-center tw-justify-center"
            >
              <svg class="tw-w-3 tw-h-3 tw-text-white" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
              </svg>
            </div>
          </button>
        </template>
      </div>
    </div>

    <!-- Thread Color Selection -->
    <div>
      <label class="tw-block tw-text-sm tw-font-medium tw-text-gray-700 tw-mb-3">
        Thread Color
      </label>
      <div class="tw-flex tw-flex-wrap tw-gap-3">
        <template x-for="color in colors" :key="color.id">
          <button
            type="button"
            @click="selectedColor = color.id"
            :title="color.name"
            :class="{
              'tw-ring-2 tw-ring-offset-2 tw-ring-blue-600': selectedColor === color.id,
              'tw-ring-1 tw-ring-gray-300 hover:tw-ring-gray-400': selectedColor !== color.id
            }"
            class="tw-relative tw-w-10 tw-h-10 tw-rounded-full tw-transition-all"
            :style="'background-color: ' + color.hex"
          >
            <div
              x-show="selectedColor === color.id"
              class="tw-absolute tw-inset-0 tw-flex tw-items-center tw-justify-center"
            >
              <svg class="tw-w-5 tw-h-5 tw-text-white tw-drop-shadow-lg" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
              </svg>
            </div>
          </button>
        </template>
      </div>
      <p class="tw-mt-2 tw-text-xs tw-text-gray-600">
        Selected: <span class="tw-font-medium" x-text="colors.find(c => c.id === selectedColor)?.name"></span>
      </p>
    </div>

    <!-- Preview Text -->
    <div
      x-show="name.length > 0"
      class="tw-p-6 tw-bg-gray-50 tw-rounded-lg tw-border tw-border-gray-200"
    >
      <p class="tw-text-xs tw-text-gray-500 tw-mb-2 tw-uppercase tw-tracking-wide">Preview</p>
      <p
        class="tw-text-2xl tw-font-medium tw-text-center"
        :style="'font-family: ' + fonts.find(f => f.id === selectedFont)?.family + '; color: ' + colors.find(c => c.id === selectedColor)?.hex"
        x-text="name"
      ></p>
    </div>

  </div>

  <!-- Hidden inputs for form submission -->
  <input type="hidden" name="properties[Embroidery]" :value="enabled ? 'Yes' : 'No'">
  <input type="hidden" name="properties[Embroidery Name]" x-model="name" x-show="enabled">
  <input type="hidden" name="properties[Embroidery Font]" :value="fonts.find(f => f.id === selectedFont)?.name" x-show="enabled">
  <input type="hidden" name="properties[Embroidery Color]" :value="colors.find(c => c.id === selectedColor)?.name" x-show="enabled">
</div>

<script>
  function embroideryCustomizer() {
    return {
      enabled: false,
      name: '',
      maxLength: 12,
      selectedFont: 'classic',
      selectedColor: 'black',
      price: 5.00,

      fonts: [
        { id: 'classic', name: 'Classic', family: 'Georgia, serif', preview: 'Abc' },
        { id: 'modern', name: 'Modern', family: 'Arial, sans-serif', preview: 'Abc' },
        { id: 'script', name: 'Script', family: 'Brush Script MT, cursive', preview: 'Abc' },
        { id: 'bold', name: 'Bold', family: 'Impact, sans-serif', preview: 'Abc' },
        { id: 'elegant', name: 'Elegant', family: 'Times New Roman, serif', preview: 'Abc' },
        { id: 'casual', name: 'Casual', family: 'Comic Sans MS, cursive', preview: 'Abc' },
      ],

      colors: [
        { id: 'black', name: 'Black', hex: '#000000' },
        { id: 'white', name: 'White', hex: '#FFFFFF' },
        { id: 'navy', name: 'Navy Blue', hex: '#1E3A8A' },
        { id: 'red', name: 'Red', hex: '#DC2626' },
        { id: 'gold', name: 'Gold', hex: '#F59E0B' },
        { id: 'green', name: 'Forest Green', hex: '#065F46' },
        { id: 'pink', name: 'Pink', hex: '#EC4899' },
        { id: 'purple', name: 'Purple', hex: '#7C3AED' },
      ],

      get nameLength() {
        return this.name.length;
      }
    }
  }
</script>

<style>
  .embroidery-section [x-cloak] {
    display: none !important;
  }
</style>
